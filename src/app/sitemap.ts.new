import { MetadataRoute } from "next";
import { getAllGames } from "@/lib/games";
import { cpus, gpus } from "@/lib/fps-predictor";

const BASE = "https://gamebencher.com";
const LOCALES = ["zh", "en"];

function localizedEntry(
  path: string,
  changeFreq: "daily" | "weekly" | "monthly",
  priority: number
): MetadataRoute.Sitemap[number][] {
  return LOCALES.map((locale) => ({
    url: `${BASE}/${locale}${path}`,
    lastModified: new Date(),
    changeFrequency: changeFreq,
    priority,
    alternates: {
      languages: Object.fromEntries(
        LOCALES.map((l) => [l, `${BASE}/${l}${path}`])
      ),
    },
  }));
}

export default function sitemap(): MetadataRoute.Sitemap {
  const games = getAllGames();

  return [
    // Static pages (×2 locales)
    ...localizedEntry("", "daily", 1.0),
    ...localizedEntry("/fps-calculator", "weekly", 0.9),
    ...localizedEntry("/gpu", "weekly", 0.8),
    ...localizedEntry("/cpu", "weekly", 0.8),

    // GPU pages (×2 locales)
    ...gpus.flatMap((gpu) => localizedEntry(`/gpu/${gpu.id}`, "monthly", 0.8)),

    // CPU pages (×2 locales)
    ...cpus.flatMap((cpu) => localizedEntry(`/cpu/${cpu.id}`, "monthly", 0.8)),

    // Game pages (×2 locales)
    ...games.flatMap((game) => localizedEntry(`/game/${game.slug}`, "monthly", 0.7)),
  ];
}
